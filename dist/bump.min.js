/** MIT License
* 
* Copyright (c) 2011 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://bumpjs.lcluber.com
*/

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("../../bower_components/Type6js/dist/type6.js")):"function"==typeof define&&define.amd?define(["exports","../../bower_components/Type6js/dist/type6.js"],i):i(t.BUMP={},t.TYPE6)}(this,function(t,i){"use strict";var e,o=function(){function t(){}return t.detect=function(t,i,e,o){this.ab.subtractVectors(t,e);var s=i+o;return s*s-this.ab.getSquaredMagnitude()>0?this.getPenetration(s):this.ab.origin()},t.getPenetration=function(t){var i=this.ab.getMagnitude();return this.ab.scale((t-i)/i)},t.ab=new i.Vector2,t}(),s=function(){function t(){}return t.detect=function(t,i,e,o){return this.ab.subtractVectors(t,e),this.penetration.absoluteVector(this.ab).opposite().add(i).add(o).isPositive()?this.getPenetration():this.penetration.origin()},t.getPenetration=function(){var t=this.penetration.minAxis();return this.penetration.setOppositeAxis(t,0),this.ab[t]<0&&(this.penetration[t]=-this.penetration[t]),this.penetration},t.ab=new i.Vector2,t.penetration=new i.Vector2,t}(),n=function(){function t(){}return t.detect=function(t,i,e,o){return this.ab.subtractVectors(t,e),this.penetration.absoluteVector(this.ab).opposite().addScalar(i).add(o).isPositive()&&this.diagonalHit(t,i,e,o)?this.getPenetration(i):this.penetration.origin()},t.diagonalHit=function(t,i,e,o){return this.setVoronoiRegion(o),0===this.voronoi.x?(0===this.voronoi.y?this.projectionAxis=this.penetration.minAxis():this.projectionAxis="y",!0):0===this.voronoi.y?(this.projectionAxis="x",!0):(this.avertex.multiplyVectors(this.voronoi,o).add(e).subtractVectors(t,this.avertex),i*i-this.avertex.getSquaredMagnitude()>0&&(this.projectionAxis="diag",!0))},t.setVoronoiRegion=function(t){this.voronoi.origin(),this.ab.x<-t.x?this.voronoi.x=-1:this.ab.x>t.x&&(this.voronoi.x=1),this.ab.y<-t.y?this.voronoi.y=-1:this.ab.y>t.y&&(this.voronoi.y=1)},t.getPenetration=function(t){if("diag"!=this.projectionAxis)this.penetration.setOppositeAxis(this.projectionAxis,0),this.ab[this.projectionAxis]<0&&(this.penetration[this.projectionAxis]=-this.penetration[this.projectionAxis]);else{var i=this.avertex.getMagnitude(),e=t-i;0===i?this.penetration.scaleVector(this.voronoi,e/1.41):this.penetration.scaleVector(this.avertex,e/i)}return this.penetration},t.ab=new i.Vector2,t.penetration=new i.Vector2,t.voronoi=new i.Vector2,t.avertex=new i.Vector2,t.vertex=new i.Vector2,t.projectionAxis="x",t}();!function(t){t.circle="circle",t.aabb="aabb"}(e||(e={}));var r=function(){function t(){}return t.test=function(t,i){return this.invert=!1,this.detect(t.body,i.body),!!this.penetration.isNotOrigin()&&(this.resolve(t,i)&&this.computeImpulse(t,i),!0)},t.detect=function(t,i){t.shape===e.circle?i.shape===e.circle?this.penetration=o.detect(t.position,t.radius,i.position,i.radius):i.shape===e.aabb&&(this.penetration=n.detect(t.position,t.radius,i.position,i.halfSize)):t.shape===e.aabb&&(i.shape===e.circle?(this.penetration=n.detect(i.position,i.radius,t.position,t.halfSize),this.invert=!0):i.shape===e.aabb&&(this.penetration=s.detect(t.position,t.halfSize,i.position,i.halfSize)))},t.resolve=function(t,i){return this.totalInverseMass=t.inverseMass+i.inverseMass,this.correction.copy(this.penetration).scale(this.percent/this.totalInverseMass),!!this.correction.isNotOrigin()&&(this.invert?(i.correctPosition(this.correction),t.correctPosition(this.correction.opposite())):(t.correctPosition(this.correction),i.correctPosition(this.correction.opposite())),!0)},t.computeImpulse=function(t,i){this.contactNormal.normalizeVector(this.penetration);var e=this.relativeVelocity.subtractVectors(t.velocity,i.velocity).dotProduct(this.contactNormal);e<0&&(e=e*Math.max(t.restitution,i.restitution)-e,this.impulse=e/this.totalInverseMass,this.impulsePerInverseMass.copy(this.contactNormal).scale(this.impulse),t.collision(this.impulsePerInverseMass,i),this.impulsePerInverseMass.opposite(),i.collision(this.impulsePerInverseMass,t))},t.penetration=new i.Vector2,t.contactNormal=new i.Vector2,t.correction=new i.Vector2,t.relativeVelocity=new i.Vector2,t.impulsePerInverseMass=new i.Vector2,t.totalInverseMass=0,t.impulse=0,t.k_slop=.01,t.percent=.99,t}(),a=function(){function t(){this.bodies=[],this.bodiesLength=0,this.iterations=1,this.gravity=new i.Vector2(0,400)}return t.prototype.addBody=function(t){return!t.collisionSceneId&&(this.bodiesLength++,t.collisionSceneId=this.bodiesLength,this.bodies.push(t),!0)},t.prototype.test=function(){for(var t=0;t<this.iterations;t++)for(var i=0;i<this.bodiesLength;i++){var e=this.bodies[i];if(e.isActive())for(var o=i+1;o<this.bodiesLength;o++){var s=this.bodies[o];s.isActive()&&r.test(e,s)}}},t.prototype.testScene=function(t){for(var i=0;i<this.iterations;i++)for(var e=0,o=this.bodies;e<o.length;e++){var s=o[e];if(s.isActive())for(var n=0,a=t.bodies;n<a.length;n++){var c=a[n];c.isActive()&&r.test(s,c)}}},t.prototype.setIteration=function(t){this.iterations=t},t}(),c=function(){function t(t,e,o,s,n,r,a,c,h,p){switch(this.damping=.8,this.mass=1,this.inverseMass=1,this.restitution=-1,this.collisionSceneId=0,this.active=!0,this.damageTaken=0,this.damageDealt=1,this.velocity=new i.Vector2(o,s),this.initialVelocity=this.velocity.clone(),this.translate=new i.Vector2,this.gravity=new i.Vector2,this.force=new i.Vector2,this.impulse=new i.Vector2,this.resultingAcc=new i.Vector2,this.mass=a,this.inverseMass=a?1/a:0,this.damping=c,this.restitution=-h,p){case"rectangle":this.body=new i.Rectangle(t,e,n,r);break;default:this.body=new i.Circle(t,e,n)}this.position=this.body.position}return t.prototype.setActive=function(){this.active=!0},t.prototype.setInactive=function(){this.active=!1},t.prototype.toggleActive=function(){return this.active=!this.active},t.prototype.isActive=function(){return this.active},t.prototype.updatePosition=function(t){return this.translate.origin(),this.active&&t>0&&(this.inverseMass&&(this.applyImpulse(),this.applyForces(t)),this.applyVelocity(t)),this.position},t.prototype.applyForces=function(t){this.resultingAcc.copy(this.gravity),this.force.isNotOrigin()&&(this.resultingAcc.addScaledVector(this.force,this.inverseMass),this.force.origin()),this.resultingAcc.isNotOrigin()&&this.velocity.addScaledVector(this.resultingAcc,t)},t.prototype.applyImpulse=function(){this.impulse.isNotOrigin()&&(this.velocity.addScaledVector(this.impulse,this.inverseMass),this.impulse.origin())},t.prototype.applyVelocity=function(t){this.velocity.isNotOrigin()&&(this.damping<1&&this.velocity.scale(Math.pow(this.damping,t)),this.translate.copy(this.velocity).scale(t),this.position.add(this.translate))},t.prototype.correctPosition=function(t){this.inverseMass&&(this.position.addScaledVector(t,this.inverseMass),this.body.setPositionFromVector(this.position))},t.prototype.setPosition=function(t,i){this.body.setPositionXY(t,i)},t.prototype.setPositionFromVector=function(t){this.body.setPositionFromVector(t)},t.prototype.setGravity=function(t,i){this.gravity.set(t,i)},t.prototype.setDamageDealt=function(t){this.damageDealt=t},t.prototype.applyDamage=function(){if(this.active&&this.damageTaken){var t=this.damageTaken;return this.damageTaken=0,t}return!1},t.prototype.collision=function(t,i){this.inverseMass&&this.impulse.copy(t),this.damageTaken||(this.damageTaken=i.damageDealt)},t.prototype.reset=function(){this.velocity.copy(this.initialVelocity),this.translate.origin(),this.force.origin(),this.impulse.origin(),this.resultingAcc.origin()},t.prototype.draw=function(t,i,e,o){this.body.draw(t,i,e,o)},t}();t.Scene=a,t.Physics=c,Object.defineProperty(t,"__esModule",{value:!0})});