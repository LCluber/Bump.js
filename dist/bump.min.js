/** MIT License
* 
* Copyright (c) 2011 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://bump.lcluber.com
*/
var TYPE6JS={Revision:"0.2.0"};TYPE6JS.MathUtils={round:function(a,b){return b=Math.pow(10,b),Math.round(a*b)/b},floor:function(a,b){return b=Math.pow(10,b),Math.floor(a*b)/b},ceil:function(a,b){return b=Math.pow(10,b),Math.ceil(a*b)/b},trunc:function(a,b){return b=Math.pow(10,b),Math.trunc(a*b)/b},roundToNearest:function(a,b){return Math.round(a/b)*b},isEven:function(a){return!(1&a)},isOdd:function(a){return 1&a},mix:function(a,b,c){return(1-c)*a+c*b},getSign:function(a){return a?0>a?-1:1:0},getOppositeSign:function(a){return-a},clamp:function(a,b,c){return Math.min(Math.max(a,b),c)},normalize:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return this.lerp(this.normalize(a,b,c),d,e)}},TYPE6JS.Random={"float":function(a,b){return a+Math.random()*(b-a)},integer:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},distribution:function(a,b,c){for(var d=0,e=0;c>e;e++)d+=this["float"](a,b);return d/c},pick:function(a,b){return Math.random()<.5?a:b}},TYPE6JS.Bezier={quadratic:function(a,b,c,d,e,f,g,h){return g*a+h*b+e*c},cubic:function(a,b,c,d,e,f,g){return Math.pow(g,3)*a+3*Math.pow(g,2)*e*b+3*g*f*c+f*e*d}},TYPE6JS.Vector2D={x:0,y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},createFromArray:function(a){var b=Object.create(this);return b.setX(a[0]),b.setY(a[1]),b},toArray:function(){return[this.x,this.y]},toString:function(){return"("+this.x+";"+this.y+")"},setX:function(a){return this.x=this.valueValidation(a),this.x},getX:function(){return this.x},setY:function(a){return this.y=this.valueValidation(a),this.y},getY:function(){return this.y},set:function(a,b){return this.hasOwnProperty(a)?(this[a]=this.valueValidation(b),this[a]):!1},get:function(a){return this.hasOwnProperty(a)?this[a]:!1},setXY:function(a,b){this.x=this.valueValidation(a),this.y=this.valueValidation(b)},setToOrigin:function(){this.x=0,this.y=0},setAngle:function(a){if(this.valueValidation(a)){var b=this.getMagnitude();return this.x=TYPE6JS.Trigonometry.cosinus(a)*b,this.y=TYPE6JS.Trigonometry.sinus(a)*b,!0}return!1},getAngle:function(){return Math.atan2(this.y,this.x)},setMagnitude:function(a){if(this.valueValidation(a)){var b=this.getAngle();return this.x=TYPE6JS.Trigonometry.cosinus(b)*a,this.y=TYPE6JS.Trigonometry.sinus(b)*a,!0}return!1},getMagnitude:function(){return Math.sqrt(this.getSquaredMagnitude())},getSquaredMagnitude:function(){return this.x*this.x+this.y*this.y},getDistance:function(a){this.subtractFrom(a);var b=this.getMagnitude();return this.addTo(a),b},getSquaredDistance:function(a){this.subtractFrom(a);var b=this.getSquaredMagnitude();return this.addTo(a),b},copy:function(a){return this.create(a.getX(),a.getY())},add:function(a){return this.create(this.x+a.getX(),this.y+a.getY())},addX:function(a){return this.create(this.x+a,this.y)},addY:function(a){return this.create(this.x,this.y+a)},addScalar:function(a){return this.create(this.x+a,this.y+a)},addScaledVector:function(a,b){return this.create(this.x+a.x*b,this.y+a.y*b)},subtract:function(a){return this.create(this.x-a.getX(),this.y-a.getY())},subtractScalar:function(a){return this.create(this.x-a,this.y-a)},scale:function(a){return this.create(this.x*a,this.y*a)},multiply:function(a){return this.create(this.x*a.x,this.y*a.y)},divide:function(a){return this.create(this.x/a.x,this.y/a.y)},halve:function(){return this.create(.5*this.x,.5*this.y)},normalize:function(){var a=this.getMagnitude();return a?this.scale(1/a):void 0},absolute:function(){return this.create(Math.abs(this.x),Math.abs(this.y))},opposite:function(){return this.create(-this.x,-this.y)},oppositeX:function(){return this.create(-this.x,this.y)},oppositeY:function(){return this.create(this.x,-this.y)},clamp:function(a){return this.create(TYPE6JS.MathUtils.clamp(this.x,a.topLeftCorner.getX(),a.topLeftCorner.getX()+a.size.getX()),TYPE6JS.MathUtils.clamp(this.y,a.topLeftCorner.getY(),a.topLeftCorner.getY()+a.size.getY()))},lerp:function(a,b,c){return this.create(TYPE6JS.MathUtils.lerp(a,b.getX(),c.getX()),TYPE6JS.MathUtils.lerp(a,b.getY(),c.getY()))},quadraticBezier:function(a,b,c,d){var e=d*d,f=1-d,g=Math.pow(f,2),h=2*f*d;return this.create(TYPE6JS.Bezier.quadratic(a.getX(),b.getX(),c.getX(),d,e,f,g,h),TYPE6JS.Bezier.quadratic(a.getY(),b.getY(),c.getY(),d,e,f,g,h))},cubicBezier:function(a,b,c,d,e){var f=e*e,g=1-e;return this.create(TYPE6JS.Bezier.cubic(a.getX(),b.getX(),c.getX(),d.getX(),e,f,g),TYPE6JS.Bezier.cubic(a.getY(),b.getY(),c.getY(),d.getY(),e,f,g))},quadraticBezierTo:function(a,b,c,d){var e=d*d,f=1-d,g=Math.pow(f,2),h=2*f*d;this.x=TYPE6JS.Bezier.quadratic(a.getX(),b.getX(),c.getX(),d,e,f,g,h),this.y=TYPE6JS.Bezier.quadratic(a.getY(),b.getY(),c.getY(),d,e,f,g,h)},cubicBezierTo:function(a,b,c,d,e){var f=e*e,g=1-e;this.x=TYPE6JS.Bezier.cubic(a.getX(),b.getX(),c.getX(),d.getX(),e,f,g),this.y=TYPE6JS.Bezier.cubic(a.getY(),b.getY(),c.getY(),d.getY(),e,f,g)},copyTo:function(a){this.x=a.getX(),this.y=a.getY()},addTo:function(a){this.x+=a.getX(),this.y+=a.getY()},addToX:function(a){this.x+=a},addToY:function(a){this.y+=a},addScalarTo:function(a){this.x+=a,this.y+=a},addScaledVectorTo:function(a,b){this.x+=a.x*b,this.y+=a.y*b},copyScaledVectorTo:function(a,b){this.x=a.x*b,this.y=a.y*b},subtractFrom:function(a){this.x-=a.getX(),this.y-=a.getY()},copySubtractFromTo:function(a,b){this.x=a.getX()-b.getX(),this.y=a.getY()-b.getY()},subtractScalarFrom:function(a){this.x-=a,this.y-=a},scaleBy:function(a){this.x*=a,this.y*=a},multiplyBy:function(a){this.x*=a.x,this.y*=a.y},divideBy:function(a){this.x/=a.x,this.y/=a.y},halveBy:function(){this.x*=.5,this.y*=.5},normalizeTo:function(){var a=this.getMagnitude();a&&this.scaleBy(1/a)},absoluteTo:function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},oppositeTo:function(){this.x=-this.x,this.y=-this.y},oppositeXTo:function(){this.x=-this.x},oppositeYTo:function(){this.y=-this.y},clampTo:function(a){this.x=TYPE6JS.MathUtils.clamp(this.x,a.topLeftCorner.getX(),a.topLeftCorner.getX()+a.size.getX()),this.y=TYPE6JS.MathUtils.clamp(this.y,a.topLeftCorner.getY(),a.topLeftCorner.getY()+a.size.getY())},lerpTo:function(a,b,c){this.x=TYPE6JS.MathUtils.lerp(a,b.getX(),c.getX()),this.y=TYPE6JS.MathUtils.lerp(a,b.getY(),c.getY())},dotProduct:function(a){return this.x*a.x+this.y*a.y},isOrigin:function(){return!this.x||!this.y},isNotOrigin:function(){return!(!this.x&&!this.y)},valueValidation:function(a){return isNaN(a)?0:a}},TYPE6JS.Geometry={Circle:{position:{},radius:0,diameter:0,create:function(a,b,c){var d=Object.create(this);return d.init(),d.setPositionXY(a,b),d.setRadius(c),d},init:function(){this.position=TYPE6JS.Vector2D.create(),this.radius=0,this.diameter=0},copy:function(a){return this.create(a.getPositionX(),a.getPositionY(),a.getRadius())},copyTo:function(a){this.setPositionFromVector2D(a.getPosition()),this.setRadius(a.getRadius())},setPositionX:function(a){return this.position.setX(a),this.position.getX()},setPositionY:function(a){return this.position.setY(a),this.position.getY()},setPositionXY:function(a,b){return this.position.setXY(a,b),this.position},setPositionFromVector2D:function(a){return this.position.copyTo(a),this.position},getPosition:function(){return this.position},getPositionX:function(){return this.position.getX()},getPositionY:function(){return this.position.getY()},setRadius:function(a){return this.radius=a,this.diameter=2*this.radius,this.radius},getRadius:function(){return this.radius},setDiameter:function(a){return this.diameter=a,this.radius=.5*this.diameter,this.diameter},getDiameter:function(){return this.diameter},clampTo:function(a){this.position.clampTo(a)},scale:function(a){return this.create(this.position.getX(),this.position.getY(),this.radius*a)},scaleBy:function(a){return this.setRadius(this.radius*a),this.radius},getDistance:function(a){return this.position.getDistance(a)},getSquaredDistance:function(a){return this.position.getSquaredDistance(a)}},Rectangle:{topLeftCorner:{},size:{},create:function(a,b,c,d){var e=Object.create(this);return e.init(),e.setSizeXY(c,d),e.setTopLeftCornerXY(a,b),e},init:function(){this.size=TYPE6JS.Vector2D.create(),this.topLeftCorner=TYPE6JS.Vector2D.create()},copy:function(a){return this.create(a.getTopLeftCornerX(),a.getTopLeftCornerY(),a.getSizeX(),a.getSizeY())},copyTo:function(a){this.setTopLeftCornerFromVector2D(a.getTopLeftCorner()),this.setSizeFromVector2D(a.getSize())},setTopLeftCornerXY:function(a,b){return this.topLeftCorner.setXY(a,b),this.topLeftCorner},setTopLeftCornerFromVector2D:function(a){return this.topLeftCorner.copyTo(a),this.topLeftCorner},getTopLeftCorner:function(){return this.topLeftCorner},getTopLeftCornerX:function(){return this.topLeftCorner.getX()},getTopLeftCornerY:function(){return this.topLeftCorner.getY()},setSizeXY:function(a,b){return this.size.setXY(a,b),this.size},setSizeFromVector2D:function(a){return this.size.copyTo(a),this.size},getSize:function(){return this.size},getSizeX:function(){return this.size.getX()},getSizeY:function(){return this.size.getY()}}},TYPE6JS.Trigonometry={PI:TYPE6JS.MathUtils.round(Math.PI,2),TWOPI:TYPE6JS.MathUtils.round(2*Math.PI,2),HALFPI:TYPE6JS.MathUtils.round(.5*Math.PI,2),sineDecimals:2,cosineDecimals:2,arctanDecimals:2,factorialArray:[],sineLoops:{0:9,1:11,2:13,3:15,4:17,5:18,6:19,7:21,8:23},cosineLoops:{0:6,1:8,2:10,3:12,4:14,5:16,6:18,7:20,8:22},arctanLoops:{0:17,1:19,2:21,3:23,4:25,5:27,6:29,7:31,8:33},setSinePrecision:function(a){return this.sineLoops.hasOwnProperty(property)?(this.sineDecimals=a,a):(this.sineDecimals=2,2)},setCosinePrecision:function(a){return this.cosineLoops.hasOwnProperty(property)?(this.cosineDecimals=a,a):(this.cosineDecimals=2,2)},degreeToRadian:function(a){return a*this.PI/180},radianToDegree:function(a){return 180*a/this.PI},sine:function(a){return a=this.normalizeRadian(a),this.sineDecimals<=2&&.28>a&&a>-.28?a:this.taylorSerie(3,this.sineLoops[this.sineDecimals],a,a,!0)},cosine:function(a){a=this.normalizeRadian(a);var b=a*a;return this.cosineDecimals<=2&&.5>=a&&a>=-.5?1-.5*b:this.taylorSerie(2,this.cosineLoops[this.cosineDecimals],1,a,!0)},arctan2:function(a,b){var c=b/a;return a>0?this.arctan(c):0>a?0>b?this.arctan(c)-this.PI:this.arctan(c)+this.PI:0>b?-this.HALFPI:b>0?this.HALFPI:!1},arctan2fromVector2D:function(a){return this.arctan2(a.getX(),a.getY())},arctan:function(a){var b=this.arctanLoops[this.arctanDecimals];return 1>a&&a>-1?this.taylorSerie(3,b,a,a,!1):a>=1?(a=1/a,-(this.taylorSerie(3,b,a,a,!1)-this.HALFPI)):(a=-1/a,this.taylorSerie(3,b,a,a,!1)-this.HALFPI)},sineEquation:function(a,b,c,d){return a*this.sine(b+c)+d},cosineEquation:function(a,b,c,d){return a*this.cosine(b+c)+d},arctanEquation:function(a,b,c,d){return a*this.arctan(b+c)+d},taylorSerie:function(a,b,c,d,e){for(var f=d*d,g=c,h=0,i=-1,j=0;b>=a;a+=2,j++)c*=f,h=e?this.factorialArray[a]:a,g+=c/h*i,i=TYPE6JS.MathUtils.getOppositeSign(i);return g},createFactorialArray:function(){for(var a=1,b=1;a<=Math.max(3*this.sineLoops[8],2*this.cosineLoops[8]);a++)b*=this.factorial(a),this.factorialArray.push(b)},factorial:function(a){return a>1?a-1:1},normalizeRadian:function(a){return a>this.PI||a<-this.PI?a-this.TWOPI*Math.floor((a+this.PI)/this.TWOPI):a}},TYPE6JS.Trigonometry.createFactorialArray();
var BUMP={revision:"0.2.0",options:{space:"2D"},translate:TYPE6JS.Vector2D.create(),velocity:TYPE6JS.Vector2D.create(),gravity:TYPE6JS.Vector2D.create(0,400),force:TYPE6JS.Vector2D.create(),impulse:TYPE6JS.Vector2D.create(),resultingAcc:TYPE6JS.Vector2D.create(),damping:.9,mass:1,inverseMass:1,elasticity:-1,shape:1,size:TYPE6JS.Vector2D.create(),halfSize:TYPE6JS.Vector2D.create(),cells:[0,0,0,0],frame:[TYPE6JS.Vector2D.create(),TYPE6JS.Vector2D.create(),TYPE6JS.Vector2D.create(),TYPE6JS.Vector2D.create()],create:function(a,b,c,d,e,f){var g=Object.create(this);return g.velocity=a,g.size=b,g.mass=c,g.inverseMass=c?1/c:0,g.elasticity=-e,g.shape=f,g},setPosition:function(a){var b=!1;return this.translate.setToOrigin(),this.resultingAcc.copyTo(this.gravity),this.impulse.isNotOrigin()&&(this.velocity.addScaledVectorTo(this.impulse,this.inverseMass),this.impulse.setToOrigin()),this.inverseMass&&this.force.isNotOrigin()&&(this.resultingAcc.addScaledVectorTo(this.force,this.inverseMass),this.force.setToOrigin()),this.resultingAcc.isNotOrigin()&&this.velocity.addScaledVectorTo(this.resultingAcc,a),this.velocity.isNotOrigin()&&(this.velocity.scaleBy(Math.pow(this.damping,a)),this.translate.copyScaledVectorTo(this.velocity,a),b=!0),this.translate},applyImpulse:function(a){this.velocity.addScaledVectorTo(a,this.inverseMass)},newCells:function(){for(var a=0;a<4;a++)this.cells[a]=Math.floor((this.fram[a].X-SCREEN.margin[3])/SCREEN.cellSize.X)+Math.floor((this.fram[a].Y-SCREEN.margin[0])/SCREEN.cellSize.Y)*SCREEN.nbCell.X},setFrame:function(){var a=this.position.getX()-this.halfSize.getX(),b=this.position.getX()+this.halfSize.getX(),c=this.position.getY()-this.halfSize.getY(),d=this.position.getY()+this.halfSize.getY();this.frame[0].setXY(a,c),this.frame[1].setXY(b,c),this.frame[2].setXY(b,d),this.frame[3].setXY(a,d)}};BUMP.Collision={delta:TYPE6JS.Vector2D.create(),penetration:TYPE6JS.Vector2D.create(),vertex:TYPE6JS.Vector2D.create(),relativeVelocity:TYPE6JS.Vector2D.create(),voronoi:TYPE6JS.Vector2D.create(),separatingVelocity:0,newSeparatingVelocity:0,deltaVelocity:0,totalInverseMass:0,impulse:0,impulsePerInverseMass:TYPE6JS.Vector2D.create(),hit:0,create:function(){var a=Object.create(this);return a},test:function(c,d,e,f){if(this.cellTest(d.cells,f.cells)&&this.aabbVSaabbHit(c,d.halfSize,e,f.halfSize))return this.hit=0,"aabb"===a.shape?"aabb"===b.shape?this.aabbVSaabb():"aabb"===b.shape&&this.circleVSaabb(e,f.halfSize,c,d.halfSize):"circle"===a.shape&&("circle"===b.shape?this.circleVScircle(d.halfSize.getX()+f.halfSize.getX()):"aabb"===b.shape&&this.circleVSaabb(c,d.halfSize,e,f.halfSize)),this.hit&&c.add(this.penetration),this.hit},cellTest:function(a,b){for(var c=0,d=-1;c<4;c++)if(d!=a[c]){for(var e=0;e<4;e++)if(a[c]===b[e])return!0;d=a[c]}return!1},aabbVSaabbHit:function(a,b,c,d){if(this.delta.copySubtractFromTo(a,c),this.penetration.copy(this.delta),this.penetration.absolute(),this.penetration.scale(-1),this.penetration.add(b),this.penetration.add(d),this.penetration.getX()>0&&this.penetration.getY()>0)return 1},aabbVSaabbProjection:function(){this.hit=1,this.penetration.x<this.penetration.y?(this.penetration.y=0,this.delta.x<0&&(this.penetration.x=-this.penetration.x)):(this.penetration.x=0,this.delta.y<0&&(this.penetration.y=-this.penetration.y))},circleVScircle:function(a){var b=this.delta.magnitude(),c=a-b;c>0&&(this.hit=1,this.penetration.copyScaledVectorTo(this.delta,c/b))},circleVSaabb:function(a,b,c,d){this.voronoi.setToOrigin();var e=this.delta.getX(),f=this.delta.getY(),g=d.getX(),h=d.getY();e<-g?this.voronoi.setX(-1):g<e&&this.voronoi.setX(1),f<-h?this.voronoi.setY(-1):h<f&&this.voronoi.setY(1);var i=this.delta.getX(),j=this.delta.getY();if(0===i)this.hit=1,0===j&&this.penetration.getX()<this.penetration.getY()?(this.penetration.setY(0),e<0&&this.penetration.oppositeXTo()):(this.penetration.setX(0),f<0&&this.penetration.oppositeYTo());else if(0===j)this.hit=1,this.penetration.setY(0),e<0&&this.penetration.oppositeXTo();else{this.vertex.copyTo(this.voronoi),this.vertex.componentProduct(d),this.vertex.add(c),this.copySubtractFromTo(a,this.vertex);var k=this.delta.magnitude();pen=b.x-k,pen>0&&(this.hit=1,0===k?this.penetration.copyScaledVectorTo(this.voronoi,pen/1.41):this.penetration.copyScaledVectorTo(this.delta,pen/k))}},computeImpulseVectors:function(a,b){this.separatingVel(a.velocity,b.velocity),this.separatingVelocity<0&&(this.newSeparatingVelocity=this.separatingVelocity*a.elasticity,this.deltaVelocity=this.newSeparatingVelocity-this.separatingVelocity,this.totalInverseMass=a.inverseMass+b.inverseMass,this.impulse=this.deltaVelocity/this.totalInverseMass,this.impulsePerInverseMass.copyScaledVectorTo(this.penetration,this.impulse),a.inverseMass&&a.impulse.addTo(this.impulsePerInverseMass),b.inverseMass&&(this.impulsePerInverseMass.scaleBy(-1),b.impulse.addTo(this.impulsePerInverseMass)))},separatingVel:function(a,b){this.penetration.normalizeTo(),this.relativeVelocity.copySubtractFromTo(a,b),this.separatingVelocity=this.relativeVelocity.dot(this.penetration)}};